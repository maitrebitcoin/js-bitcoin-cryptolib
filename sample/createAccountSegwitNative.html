<!DOCTYPE html>
<html>
<head>
    <title>Sample - Create native segwit bitcoin account </title>    
    <link rel="stylesheet" href="style.css">
</head>
<body>
<button onclick="onClicCreate()" id="btnCreate"> Create native segwit bitcoin account </button>
<p><p>
<hr>
public address :
 <p id="public" hidden=true>
    <span id="publicAdress"></span>
    <br>
    <br>
    <button onclick="getMoreAdresses(5)">more adresses</button>    
    <button onclick="showExtPubKey()"> show exp pub key  </button>    
    <button onclick="onCopy('publicAdress')"> copy </button>    
</p>
<hr>
secret phrase :
<p id="secret" hidden=true>
</p>

<!----------------------------- javscript code -------------------------------->

<script src='../src/js-bitcoin-lib.js'></script> 
<script src='sample-utils.js'></script>  
<script>


async function onClicCreate() {
    document.getElementById("btnCreate").hidden = true
    await createBtcAccountSegwit();
    document.getElementById("btnCreate").hidden = false
}

var gNumAccount = 0;
var gWallet     = undefined;
async function createBtcAccountSegwit() {

    // create a new wallet 
    gWallet   = new BitcoinWallet(  WalletType.SEGWIT_NATIVE  );
    // generate a random buffer
    var randomBuffer = gWallet.getRandomBuffer(128)
    // calculate the mnemonic phrase from this buffer
    // ex : "pistol thunder want public animal educate laundry all churn federal slab behind media front glow"
    var phrase       = bip39phraseFromRandomBuffer(randomBuffer)
    var seed         = seedFromPhrase(phrase)
    // use the seed a the base for all adresses calculations
    gWallet.initFromSeed(seed)
    // get the 1st public adress. 
    var pubAdress0   =  gWallet.getPublicAddress(0)
    

    var prettyPhrase = "<table align='center'><tr>"
    var tabWord = phrase.split(' ')
    for (var i=0;i<tabWord.length;i++) {
        var rc = (i>0 && i%2==0)  
        if (rc) prettyPhrase += "</tr><tr>"          
        prettyPhrase += "<td id='numword'>&nbsp" + (i+1)+ "&nbsp</td>"   
        prettyPhrase += "<td>" + tabWord[i] + "</td>"
        prettyPhrase += "<td>&nbsp&nbsp</td>"
 
    }
    prettyPhrase+='</tr></table>'

    // show result
    document.getElementById("publicAdress").innerHTML = pubAdress0 ; 
    document.getElementById("public").hidden    = false   
    document.getElementById("secret").innerHTML = prettyPhrase ;    
    document.getElementById("secret").hidden    = false   
}

function showExtPubKey() {
    // get extended public key in string base 58 format
    var extPubKey58 =  gWallet.getExtendedPublicKey()
    // show advanced results
    var avResult = ""   
    avResult += "<p class='extpubkey'>" + extPubKey58 + "</p>"
    document.getElementById("publicAdress").innerHTML += avResult    
    
}
function getMoreAdresses(nbAdresse) {

    for (var i=0;i<nbAdresse;i++) {

        // get the next public adress. 
        gNumAccount++;
        var pubAdressN   =  gWallet.getPublicAddress(gNumAccount)

        // show result
        document.getElementById("publicAdress").innerHTML += "<br>" + pubAdressN ; 
        document.getElementById("public").hidden    = false   
    }
}

</script>

</body>
</html>