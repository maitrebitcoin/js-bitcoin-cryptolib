<!DOCTYPE html>
<html>
<body>

<h1> js-bitcoin-cryptolib test page </h1>
<p><hr><p>

<button onclick="testSha()">       <h2> Test sha256 </h2> </button>
<button onclick="testSha512()">    <h2> Test sha512 </h2> </button>
<button onclick="testHmacSha512()"><h2> Test hmac-sha512 </h2> </button>
<button onclick="testEcdsa()">     <h2> Test ecdsa  </h2> </button>
<button onclick="ecdsaSample()">   <h2> Ecdsa sample</h2> </button>
<p><p>

<p style="font-family:monospace;font-size:160%" id="resultat">
    <!--auto test result here-->
</p>

<!----------------------------- javscript code -------------------------------->
<script src='GField.js'></script>
<script src='EllipticCurveSecp256k1.js'></script>
<script src='ECDSA.js'></script>
<script src='sha.js'></script>
<script src='autotest.js'></script>
<script src='hex.js'></script>
<script src='hdwallet.js'></script>

<script>

// called if a test fails
function onTestFail( s, hashAsHexString, expected)
{
    var sErr = "hash('" + s+ "') => <br>\n" +  hashAsHexString+' != <br>\n'+expected
    console.log(sErr)

    document.getElementById("resultat").innerHTML = "<p>"  +sErr + "<p><font color='red'>FAILED</font>";
    console.assert(false)
    // stop the test
    throw -1;
}

function testSha() {
    // Start...
    document.getElementById("resultat").innerHTML += "<font color='gray'>Running...</font>";
    // Run the test async :
    setTimeout( () => {
        
        // Run tests...
        autotest_sha256( onTestFail  )
        // test PASSED OK
        document.getElementById("resultat").innerHTML += "<p><font color='green'>PASSED OK</font>";
        },0
    )
}
function testSha512() {
     // Start...
    document.getElementById("resultat").innerHTML += "<font color='gray'>Running...</font>";       
        // Run tests...
        autotest_sha512( onTestFail  )
        // test PASSED OK
        document.getElementById("resultat").innerHTML = "<p><font color='green'>PASSED OK</font>";
}
function testHmacSha512() {
     // Start...
    document.getElementById("resultat").innerHTML += "<font color='gray'>Running...</font>";       
        // Run tests...
        autotest_hmac_sha512( onTestFail  )
        // test PASSED OK
        document.getElementById("resultat").innerHTML = "<p><font color='green'>PASSED OK</font>";
}

function testEcdsa() {
    // Start...
    document.getElementById("resultat").innerHTML += "<font color='gray'>Running...</font>";
    // Run the test async :
    setTimeout( () => {
        
        // Run tests...
        autotest_ecdsa(  onTestFail  )

        // test PASSED OK
        document.getElementById("resultat").innerHTML += "<p><font color='green'>PASSED OK</font>";
        },0
    )
}



function ecdsaSample() {

    var ecdsa = new ECDSA();
    // create key pair
    var priv = ecdsa.newPrivateKey();
    var pub  = ecdsa.publicKeyFormPrivateKey(priv);
    // show keys
    var sDump = "private key :<p>" + priv.toString()
              + "<hr>"
              + "public key :<p>" + pub.toString() 
    // sign  a message
    var sMessage = "abdefghijlk12345"                

    sDump += "<hr>message :<p><span style='background-color:#b0b0a0;'>" + sMessage + "</span><p>\n"
    var signature = ecdsa.signMessage( sMessage, priv )
        sDump += "<hr>signature : <p><span style='background-color:#b0e0e0;'>" + signature.toString() + "</span>"

    document.getElementById("resultat").innerHTML = sDump;

    // check signature
    var res = ecdsa.verifySignature(sMessage, signature, pub )
    sDump += "<hr>test signature : " + res.message

    document.getElementById("resultat").innerHTML = sDump;
}
</script>

</body>
</html>