<!DOCTYPE html>
<html>
<body>

<h1> js-bitcoin-cryptolib test page </h1>
<p><hr><p>

<button onclick="testSha()">  <h2> Test sha256 </h2> </button>
<button onclick="testfunc()"> <h2> Test signature </h2> </button>
<p><p>




<p style="font-family:monospace;font-size:160%" id="resultat">
xxx

</p>


<script src='GField.js'></script>
<script src='EllipticCurveSecp256k1.js'></script>
<script src='ECDSA.js'></script>
<script src='sha256.js'></script>
<script src='autotest.js'></script>
<script src='hex.js'></script>

<script>



function testSha() {
    
    // called if a test fails
    function onTestFail( s, hashAsHexString, expected)
    {
        var sErr = "sha('" + s+ "') => <br>\n" +  hashAsHexString+' != <br>\n'+expected
        console.log(sErr)

        document.getElementById("resultat").innerHTML = "<p>"  +sErr + "<p><font color='red'>FAILED</font>";
        console.assert(false)
        // stop the test
        throw -1;
    }
    // Start...
    document.getElementById("resultat").innerHTML = "<font color='gray'>Running...</font>";
    // Run the test async :
    setTimeout( () => {
        // Run test
        autotest_sha256( onTestFail  )
        // test PASSED OK
        document.getElementById("resultat").innerHTML = "<font color='green'>PASSED OK</font>";
        },0
    )
}


function testfunc() {

 var ecdsa = new ECDSA();
 // create key pair
 var priv = ecdsa.newPrivateKey();
 var pub  = ecdsa.publicKeyFormPrivateKey(priv);

 var sDump =   priv.toString()
              + "<hr>"
              + pub.toString() 
 // sign  a message
 var sMessage = "abdefgh"                
 var signature = ecdsa.signMessage( sMessage, priv )
        sDump += "<hr>signature : r= "  +  hex( signature.r )
              + " s = "
              +  hex( signature.s )
            

  document.getElementById("resultat").innerHTML = sDump;
}
</script>

</body>
</html>